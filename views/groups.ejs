<!DOCTYPE html>
<html lang="en" class="">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Groups - SyncRoom</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/animations.css">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .fade-in {
      animation: fadeInAnimation 0.5s ease-out forwards;
    }
    @keyframes fadeInAnimation {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
    .dark ::-webkit-scrollbar-thumb { background: #4b5563; }
    ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    .dark ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

    .group-avatar {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
    }
    .tab-btn.active-tab {
        color: #4f46e5;
        background-color: #eef2ff;
    }
    .dark .tab-btn.active-tab {
        color: #c7d2fe;
        background-color: #3730a3;
    }
    
    /* --- Watery/Liquid Button Effects --- */
    @keyframes water-wave {
      0% { transform: translateX(-100%) translateY(-50%) rotate(0deg); }
      100% { transform: translateX(100%) translateY(-50%) rotate(360deg); }
    }
    
    @keyframes ripple {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(4); opacity: 0; }
    }
    
    .liquid-button {
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
    }
    
    .liquid-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .liquid-button:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .liquid-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: water-wave 3s linear infinite;
    }
    
    .liquid-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.5), 0 8px 10px -6px rgba(99, 102, 241, 0.4);
    }
    
    .liquid-button:active {
      transform: translateY(0);
    }
    
    .ripple-effect {
      position: relative;
      overflow: hidden;
    }
    
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      animation: ripple 0.6s ease-out;
      pointer-events: none;
    }
    
    /* Glass Morphism */
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .dark .glass-effect {
      background: rgba(17, 24, 39, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Water Card Effect */
    .water-card {
      position: relative;
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.23, 1, 0.320, 1);
    }
    
    .water-card::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.2) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.8s ease-out, height 0.8s ease-out;
    }
    
    .water-card:hover::before {
      width: 500px;
      height: 500px;
    }
    
    .water-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px -10px rgba(99, 102, 241, 0.4);
    }
    
    /* Floating Animation */
    @keyframes float-gentle {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(2deg); }
    }
    
    .float-animation {
      animation: float-gentle 4s ease-in-out infinite;
    }
    
    /* Animated Background */
    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .animated-gradient {
      background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
      background-size: 400% 400%;
      animation: gradient-shift 15s ease infinite;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans transition-colors duration-300">

  <!-- Main Content Container -->
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">

    <!-- Header Section -->
    <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 fade-in">
      <div>
        <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white">Welcome, <%= user.username %>!</h1>
        <p class="text-gray-500 dark:text-gray-400 mt-1">Your personal collaboration dashboard.</p>
      </div>
      <div class="flex items-center gap-4 mt-4 sm:mt-0">
        <a href="/logout" class="text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-indigo-500 transition-colors">Logout</a>
        <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none rounded-lg text-sm p-2.5">
            <i id="theme-toggle-dark-icon" class="fas fa-moon w-5 h-5"></i>
            <i id="theme-toggle-light-icon" class="fas fa-sun w-5 h-5 hidden"></i>
        </button>
      </div>
    </header>

    <!-- Search and Action Bar -->
    <div class="mb-8 fade-in" style="animation-delay: 0.1s;">
      <div class="flex flex-col sm:flex-row gap-4">
        <div class="relative flex-grow">
          <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-500">
            <i class="fas fa-search"></i>
          </span>
          <input type="text" id="searchInput" placeholder="Search your groups..." class="w-full pl-12 pr-4 py-3 rounded-full text-gray-900 dark:text-white bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 transition-all duration-300">
        </div>
        <button id="open-modal-btn" class="w-full sm:w-auto flex-shrink-0 bg-indigo-600 text-white px-6 py-3 rounded-full shadow-md flex items-center justify-center font-semibold liquid-button ripple-effect">
          <i class="fas fa-plus mr-2"></i> Create or Join
        </button>
        <a href="/ai-chat" class="w-full sm:w-auto flex-shrink-0 bg-purple-600 text-white px-6 py-3 rounded-full shadow-md flex items-center justify-center font-semibold liquid-button ripple-effect">
            <i class="fas fa-robot mr-2"></i> Chat with AI
        </a>
      </div>
    </div>

    <!-- Groups Grid -->
    <div id="groupsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 fade-in" style="animation-delay: 0.2s;">
      <% if (groups.length === 0) { %>
        <div class="col-span-full text-center py-20 bg-white dark:bg-gray-800/50 rounded-2xl border-2 border-dashed border-gray-300 dark:border-gray-700">
          <i class="fas fa-users text-5xl text-gray-400 dark:text-gray-500 mb-4"></i>
          <h2 class="text-2xl font-bold text-gray-700 dark:text-gray-300">Your Dashboard is Empty</h2>
          <p class="text-gray-500 dark:text-gray-400 mt-2">Create a new group or join an existing one to start collaborating.</p>
          <button id="open-modal-btn-empty" class="mt-6 bg-indigo-600 text-white px-6 py-3 rounded-full font-semibold liquid-button ripple-effect">
            Get Started
          </button>
        </div>
      <% } else { %>
        <% 
          const colors = ['bg-red-500', 'bg-green-500', 'bg-blue-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'];
          groups.forEach((group, index) => { 
            const colorClass = colors[Math.abs(group.name.charCodeAt(0)) % colors.length];
        %>
          <div class="group-card bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 flex flex-col animate-fade-in-up water-card glass-effect" data-index="<%= index %>">
            <div class="flex-grow">
              <div class="flex items-center space-x-4 mb-4">
                <div class="group-avatar <%= colorClass %> float-animation">
                  <%= group.name.charAt(0).toUpperCase() %>
                </div>
                <div>
                  <h3 class="font-bold group-name text-xl text-gray-900 dark:text-white"><%= group.name %></h3>
                  <span class="text-xs capitalize bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full font-medium"><%= group.role %></span>
                </div>
              </div>
              <p class="text-gray-600 dark:text-gray-400 text-sm mb-6 line-clamp-2">A collaborative space for your team to share ideas and files.</p>
            </div>
            <a href="/chat/<%= group.id %>" class="text-center w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md liquid-button ripple-effect">
              Enter Chat <i class="fas fa-arrow-right ml-2"></i>
            </a>
          </div>
        <% }) %>
      <% } %>
    </div>
  </div>

  <!-- Modal for Create/Join Group -->
  <div id="group-modal" class="hidden fixed inset-0 z-50 items-center justify-center bg-black/60 backdrop-blur-sm">
    <div class="bg-white dark:bg-gray-800 w-full max-w-md m-4 p-1 rounded-2xl shadow-2xl relative text-gray-800 dark:text-gray-200 transform transition-all duration-300 scale-95 border border-gray-200 dark:border-gray-700">
      <!-- Close Button -->
      <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition z-10">
        <i class="fas fa-times fa-lg"></i>
      </button>

      <!-- Tabs -->
      <div class="p-2 bg-gray-100 dark:bg-gray-900/50 rounded-t-xl flex gap-2">
        <button id="create-tab" class="tab-btn active-tab w-1/2 text-center font-semibold py-2 rounded-lg transition-colors">Create Group</button>
        <button id="join-tab" class="tab-btn w-1/2 text-center font-semibold py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700/50 transition-colors">Join Group</button>
      </div>

      <div class="p-6">
        <!-- Create Group Form -->
        <div id="create-form">
          <h2 class="text-2xl font-bold mb-4">Create a New Group</h2>
          <form action="/groups/create" method="POST" class="space-y-4">
            <input type="text" name="name" placeholder="Group Name" class="w-full p-3 border-2 border-gray-200 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
            <input type="password" name="key" placeholder="Group Key (Password)" class="w-full p-3 border-2 border-gray-200 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
            <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold shadow-md liquid-button ripple-effect">Create Group</button>
          </form>
        </div>
        
        <!-- Join Group Form -->
        <div id="join-form" class="hidden">
          <h2 class="text-2xl font-bold mb-4">Join an Existing Group</h2>
          <form action="/groups/join" method="POST" class="space-y-4">
            <input type="text" name="name" placeholder="Group Name" class="w-full p-3 border-2 border-gray-200 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
            <input type="password" name="key" placeholder="Group Key (Password)" class="w-full p-3 border-2 border-gray-200 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
            <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold shadow-md liquid-button ripple-effect">Join Group</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Theme Management ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

        const setTheme = (isDark) => {
            document.documentElement.classList.toggle('dark', isDark);
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggleLightIcon.classList.toggle('hidden', !isDark);
            themeToggleDarkIcon.classList.toggle('hidden', isDark);
        };

        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('theme');
        const isInitiallyDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
        setTheme(isInitiallyDark);

        themeToggleBtn.addEventListener('click', () => {
            const isCurrentlyDark = document.documentElement.classList.contains('dark');
            setTheme(!isCurrentlyDark);
        });

        // --- Search Functionality ---
        const searchInput = document.getElementById('searchInput');
        const groupsGrid = document.getElementById('groupsGrid');
        searchInput.addEventListener('keyup', () => {
            const filter = searchInput.value.toLowerCase();
            const items = groupsGrid.querySelectorAll('.group-card');
            items.forEach(item => {
                const groupName = item.querySelector('.group-name').textContent.toLowerCase();
                item.style.display = groupName.includes(filter) ? 'flex' : 'none';
            });
        });

        // --- Modal & Tab Logic ---
        const modal = document.getElementById('group-modal');
        const modalContent = modal.querySelector('div > div');
        const openBtn = document.getElementById('open-modal-btn');
        const openBtnEmpty = document.getElementById('open-modal-btn-empty');
        const closeBtn = document.getElementById('close-modal-btn');
        
        const createTab = document.getElementById('create-tab');
        const joinTab = document.getElementById('join-tab');
        const createForm = document.getElementById('create-form');
        const joinForm = document.getElementById('join-form');

        const openModal = () => {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => modalContent.classList.remove('scale-95'), 10);
        };

        const closeModal = () => {
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 200);
        };

        openBtn.addEventListener('click', openModal);
        if (openBtnEmpty) {
          openBtnEmpty.addEventListener('click', openModal);
        }
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        const switchTabs = (activeTab) => {
            const isCreateActive = activeTab === 'create';
            createForm.classList.toggle('hidden', !isCreateActive);
            joinForm.classList.toggle('hidden', isCreateActive);
            
            createTab.classList.toggle('active-tab', isCreateActive);
            joinTab.classList.toggle('active-tab', !isCreateActive);
            joinTab.classList.toggle('text-gray-500', isCreateActive);
            joinTab.classList.toggle('dark:text-gray-400', isCreateActive);
        };

        createTab.addEventListener('click', () => switchTabs('create'));
        joinTab.addEventListener('click', () => switchTabs('join'));

        document.querySelectorAll('.animate-fade-in-up').forEach(el => {
            const index = parseInt(el.dataset.index, 10);
            el.style.animationDelay = `${index * 100}ms`;
        });
        
        // --- Ripple Effect on Click ---
        document.addEventListener('click', function(e) {
          const target = e.target.closest('.ripple-effect');
          if (!target) return;
          
          const ripple = document.createElement('span');
          ripple.classList.add('ripple');
          
          const rect = target.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          const x = e.clientX - rect.left - size / 2;
          const y = e.clientY - rect.top - size / 2;
          
          ripple.style.width = ripple.style.height = size + 'px';
          ripple.style.left = x + 'px';
          ripple.style.top = y + 'px';
          
          target.appendChild(ripple);
          
          setTimeout(() => {
            ripple.remove();
          }, 600);
        });
    });
  </script>
</body>
</html>

